---
title: "S&P500 Momentum Long/Short"
author: "Paul Nheera"
date: "09 October 2017"
output: html_document
---

```{r}
library(quantmod)
library(PerformanceAnalytics)
library(rvest)
library(readxl)
library(readr)
library(dygraphs)

source("momentum_strat.R")
source("portfolio_backtest.R")
```

```{r}
#Clean Data:

SP500 = as.matrix(read_csv("SP500.csv"))
SP500 = SP500[,-which(colSums(is.na(SP500)) ==nrow(SP500))]

SP500[which(SP500=="#N/A N/A",arr.ind = TRUE)] = NA

SP500 = as.xts(SP500[,-1],order.by = as.POSIXct(SP500[,1]))
#SP500 = as.matrix(SP500)
#SP500[,] = apply(SP500,2,as.numeric)
storage.mode(SP500) = "numeric"
```


```{r}
portfolios = MoM_strat(SP500,3,1,1,"2007-05-31")
port1 = runBacktest(portfolios[,,1],SP500,100000,cashRate = 0,Cost=0)
port5 = runBacktest(portfolios[,,5],SP500,100000,cashRate = 0,Cost=0)

comb = merge.xts(as.xts(port1[,"Total"]),as.xts(port5[,"Total"])); colnames(comb) = c("Long","Short")

#Monthly Returns of the Two Portfolios:
ret1 = ROC(port1[,"Total",drop=FALSE])
ret5 = ROC(port5[,"Total",drop=FALSE])

#Create Long and Short Portfolio Monthly Returns:
long.ret = ret1
short.ret = -ret5

#Cummulative Returns for the Long and Short Portfolio:
long = long.ret
short = short.ret

long[!is.na(long)] = cumprod(1+na.trim(long.ret))
short[!is.na(short)] = cumprod(1+na.trim(short.ret))

#Combine the long and short porfolio:
LongShort = long+short

LongShort.ret = ROC(LongShort)


#Chart Output:
charts.PerformanceSummary(LongShort.ret)
```

